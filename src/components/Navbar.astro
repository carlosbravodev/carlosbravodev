---
import Image from "astro/components/Image.astro";
import githubIcon from "../assets/github.svg";
import linkedinIcon from "../assets/linkedin.svg";
---

<header
  id="landing-header"
  class="py-4 px-6 md:px-10 flex items-center fixed top-0 w-full justify-between z-40 text-white font-brico transition-colors duration-300 group"
>
  <!-- Logo -->
  <div class="flex grow basis-0">
    <a
      href="#"
      class="text-2xl font-black bg-white text-black px-4 py-2 rounded-lg border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200 group-[.is-scrolled]:bg-black group-[.is-scrolled]:text-white group-[.is-scrolled]:border-white group-[.is-scrolled]:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] group-[.is-scrolled]:hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)]"
      >CB</a
    >
  </div>

  <!-- Desktop Navigation -->
  <nav class="hidden xl:block">
    <ul id="desktop-nav" class="flex text-xl gap-2">
      <li>
        <a
          href="#model-s"
          class="relative z-10 inline-flex items-center font-bold px-4 py-3 rounded-lg text-white transition-colors duration-200"
          >About</a
        >
      </li>
      <li>
        <a
          href="#model-3"
          class="relative z-10 inline-flex items-center font-bold px-4 py-3 rounded-lg text-white transition-colors duration-200"
          >Projects</a
        >
      </li>
      <li>
        <a
          href="#model-x"
          class="relative z-10 inline-flex items-center font-bold px-4 py-3 rounded-lg text-white transition-colors duration-200"
          >Contact</a
        >
      </li>
    </ul>
  </nav>

  <!-- Desktop Social Links + Mobile Menu Button -->
  <nav class="flex grow justify-end basis-0">
    <ul class="flex items-center gap-4">
      <li class="hidden xl:block">
        <a
          href="#"
          class="flex items-center gap-2 font-bold px-4 py-2 rounded-lg bg-white text-black border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200 group-[.is-scrolled]:bg-black group-[.is-scrolled]:text-white group-[.is-scrolled]:border-white group-[.is-scrolled]:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] group-[.is-scrolled]:hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)]"
        >
          <Image
            src={githubIcon}
            alt="github icon"
            class="w-5 h-5 invert group-[.is-scrolled]:invert-0 transition-all duration-200"
          />
          <span>GitHub</span>
        </a>
      </li>
      <li class="hidden xl:block">
        <a
          href="#"
          class="flex items-center gap-2 font-bold px-4 py-2 rounded-lg bg-white text-black border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200 group-[.is-scrolled]:bg-black group-[.is-scrolled]:text-white group-[.is-scrolled]:border-white group-[.is-scrolled]:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] group-[.is-scrolled]:hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)]"
        >
          <Image
            src={linkedinIcon}
            alt="linkedin icon"
            class="w-5 h-5 invert group-[.is-scrolled]:invert-0 transition-all duration-200"
          />
          <span>LinkedIn</span>
        </a>
      </li>
      <li class="xl:hidden">
        <button
          id="menu-btn"
          class="font-black px-5 py-2 rounded-lg border-4 border-black bg-white text-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200 group-[.is-scrolled]:bg-black group-[.is-scrolled]:text-white group-[.is-scrolled]:border-white group-[.is-scrolled]:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] group-[.is-scrolled]:hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)]"
          >MENÃš</button
        >
      </li>
    </ul>
  </nav>

  <!-- Mobile Menu -->
  <nav
    id="modal-menu"
    class="xl:hidden fixed top-0 left-0 right-0 bottom-0 bg-black z-50 transform translate-x-full transition-transform duration-300 ease-in-out"
  >
    <div class="flex flex-col h-full p-6">
      <!-- Close Button -->
      <div class="flex justify-end mb-8">
        <button
          id="close-btn"
          class="p-3 rounded-lg border-4 border-white bg-black text-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200"
        >
          <svg
            class="w-6 h-6 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="3"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Mobile Navigation Links -->
      <ul class="flex flex-col gap-4 mb-8">
        <li>
          <a
            href="#home"
            class="block w-full text-left text-2xl font-black px-6 py-4 rounded-lg border-4 border-white bg-black text-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200"
          >
            About
          </a>
        </li>
        <li>
          <a
            href="#model-s"
            class="block w-full text-left text-2xl font-black px-6 py-4 rounded-lg border-4 border-white bg-black text-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200"
          >
            Projects
          </a>
        </li>
        <li>
          <a
            href="#model-3"
            class="block w-full text-left text-2xl font-black px-6 py-4 rounded-lg border-4 border-white bg-black text-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200"
          >
            Contact
          </a>
        </li>
      </ul>

      <!-- Mobile Social Links -->
      <div class="mt-auto grid grid-cols-2 gap-3">
        <a
          href="#"
          class="flex items-center justify-center gap-2 text-lg font-bold px-4 py-4 rounded-lg border-4 border-white bg-black text-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200"
        >
          <Image src={githubIcon} alt="github icon" class="w-6 h-6" />
          <span>GitHub</span>
        </a>
        <a
          href="#"
          class="flex items-center justify-center gap-2 text-lg font-bold px-4 py-4 rounded-lg border-4 border-white bg-black text-white shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] hover:shadow-[6px_6px_0px_0px_rgba(255,255,255,1)] hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all duration-200"
        >
          <Image src={linkedinIcon} alt="linkedin icon" class="w-6 h-6" />
          <span>LinkedIn</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- Menu Backdrop for Desktop Hover Effect -->
  <div
    id="menu-backdrop"
    class="xl:absolute bg-white rounded-lg border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] translate-x-(--left) translate-y-(--top) left-0 top-0 w-(--width) h-(--height) transition-all duration-300 ease-out invisible opacity-0 -z-10 pointer-events-none"
    style="display: none;"
  >
  </div>
</header>
<script>
  const header = document.querySelector("#landing-header");
  window.addEventListener("scroll", () => {
    if (window.scrollY > 50) {
      header?.classList.add("is-scrolled", "bg-black");
    } else {
      header?.classList.remove("is-scrolled", "bg-black");
    }
  });
</script>

<script>
  const menuBtn = document.getElementById("menu-btn") as HTMLButtonElement;
  const modalMenu = document.querySelector("#modal-menu") as HTMLElement;
  const menuItems = modalMenu?.querySelectorAll("li>a") || [];
  const closeBtn = document.querySelector("#close-btn") as HTMLButtonElement;

  function openMenu() {
    if (modalMenu) {
      modalMenu.classList.remove("translate-x-full");
      modalMenu.classList.add("translate-x-0");
      document.body.style.overflow = "hidden"; // Prevent scrolling when menu is open
    }
  }

  function closeMenu() {
    if (modalMenu) {
      modalMenu.classList.remove("translate-x-0");
      modalMenu.classList.add("translate-x-full");
      document.body.style.overflow = ""; // Restore scrolling
    }
  }

  menuBtn?.addEventListener("click", (e) => {
    e.preventDefault();
    openMenu();
  });

  closeBtn?.addEventListener("click", (e) => {
    e.preventDefault();
    closeMenu();
  });

  menuItems.forEach((item) => {
    item.addEventListener("click", () => {
      closeMenu();
    });
  });

  // Close menu on escape key
  document.addEventListener("keydown", (e) => {
    if (
      e.key === "Escape" &&
      modalMenu &&
      !modalMenu.classList.contains("translate-x-full")
    ) {
      closeMenu();
    }
  });
</script>

<script>
  const listItem = document.querySelectorAll("#desktop-nav li");
  const menuBackDrop = document.querySelector("#menu-backdrop") as HTMLElement;

  // Only enable backdrop on desktop
  const isDesktop = () => window.innerWidth >= 1280; // xl breakpoint

  listItem.forEach((item) => {
    const link = item.querySelector("a") as HTMLAnchorElement;

    item.addEventListener("mouseenter", () => {
      if (!isDesktop() || !menuBackDrop) return;

      const { left, top, width, height } = item.getBoundingClientRect();

      menuBackDrop.style.setProperty("--left", `${left}px`);
      menuBackDrop.style.setProperty("--top", `${top}px`);
      menuBackDrop.style.setProperty("--width", `${width}px`);
      menuBackDrop.style.setProperty("--height", `${height}px`);

      menuBackDrop.style.display = "block";
      menuBackDrop.style.opacity = "1";
      menuBackDrop.style.visibility = "visible";

      // Check if header is scrolled (dark mode)
      const header = document.querySelector("#landing-header");
      const isScrolled = header?.classList.contains("bg-black");

      if (isScrolled) {
        // Invert backdrop styles for dark mode - Border only
        menuBackDrop.style.backgroundColor = "rgba(0,0,0,0)"; // Transparent bg
        menuBackDrop.style.borderColor = "#ffffff";
        menuBackDrop.style.boxShadow = "4px 4px 0px 0px rgba(255,255,255,1)";

        // Keep text white when backdrop is outline only
        if (link) {
          link.style.color = "#ffffff";
        }
      } else {
        // Default styles - Solid white box
        menuBackDrop.style.backgroundColor = "#ffffff"; // White bg
        menuBackDrop.style.borderColor = "#000000";
        menuBackDrop.style.boxShadow = "4px 4px 0px 0px rgba(0,0,0,1)";

        // Change text color to black when backdrop is filled white
        if (link) {
          link.style.color = "#000000";
        }
      }
    });

    item.addEventListener("mouseleave", () => {
      if (!menuBackDrop) return;

      menuBackDrop.style.opacity = "0";
      menuBackDrop.style.visibility = "hidden";

      // Hide display after transition
      setTimeout(() => {
        if (menuBackDrop.style.opacity === "0") {
          menuBackDrop.style.display = "none";
        }
      }, 300);

      // Restore text color to white
      if (link) {
        link.style.color = "";
      }
    });
  });

  // Hide backdrop when resizing to mobile
  window.addEventListener("resize", () => {
    if (!isDesktop() && menuBackDrop) {
      menuBackDrop.style.display = "none";
      menuBackDrop.style.opacity = "0";
      menuBackDrop.style.visibility = "hidden";
    }
  });
</script>

<script>
  const headerEl = document.querySelector("#landing-header") as HTMLElement;

  const observerOptions = {
    root: null,
    rootMargin: "0px",
    threshold: 0.9,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      const { isIntersecting } = entry;
      if (isIntersecting) {
        const color = entry.target.getAttribute("data-header-color");
        if (color) {
          headerEl.style.color = color;
        }
      }
    });
  }, observerOptions);

  const sectionElements = document.querySelectorAll(".landing-section");
  sectionElements.forEach((section) => observer.observe(section));
</script>
